# Multi-Monitor Wallpaper Generator

A Python tool that generates combined wallpaper images for multi-monitor setups. It detects your monitor configuration
using `xrandr` and maps individual images to each screen, handling different resolutions, positions, and color profiles.

## Features

- Automatic screen detection (width, height, and relative position) via `xrandr`.
- Manual monitor specification for custom layouts via YAML configuration.
- Batch processing - generate multiple wallpaper sets from a single configuration file.
- Resizes and center-crops images to perfectly fit each monitor's aspect ratio (cover mode).
- Supports arbitrary monitor arrangements (horizontal, vertical, or mixed).
- Fills empty spaces with a customizable background color.
- **ICC profile baking** - converts embedded color profiles to target monitor profile (essential for GNOME users).
- Multi-threaded rendering for fast batch processing.

## Requirements

- **Operating System**: Linux with X11 (required for `xrandr` support).
- **Python**: 3.12+
- **System Tools**: `xrandr` (standard on most Linux distributions with X11).
- **Python Dependencies**: See `requirements.txt`.

## Setup

1. **Clone the repository**:
   ```bash
   git clone <repository-url>
   cd multi-monitor-wallpaper-gen
   ```

The `start.sh` script will automatically create a virtual environment, install dependencies, and run the tool.

## Usage

### Step 1: Initialize Configuration

Run the init command to detect your monitors and create the configuration file:

```bash
./start.sh init
```

This will:

- Detect your monitors using `xrandr`
- Create a `config.yaml` file with your screen layout
- Add a sample image set to get you started

### Step 2: Configure Image Sets

Edit `config.yaml` to add your wallpaper sets. Each set maps images to your monitors:

```yaml
# Monitor configuration - generated by `init` command
screens:
  - device_id: DP-4          # Monitor identifier (from xrandr, can be anything for you to identify this monitor)
    x_pos: 0                 # X position on canvas (0 = left edge)
    y_pos: 0                 # Y position on canvas (0 = top edge)
    width: 5120              # Screen width in pixels
    height: 2160             # Screen height in pixels
    icc: /path/to/monitor.icc  # Optional: ICC color profile for this monitor
  - device_id: HDMI-0
    x_pos: 5120              # Positioned to the right of first monitor
    y_pos: 0
    width: 1440
    height: 2560
    icc: /path/to/second-monitor.icc

# Global settings
background_color: black      # Fill color for empty canvas areas
default_image: /path/to/default.png  # Fallback image if a screen has no image
fit_mode: COVER               # Image fit: COVER (crop to fill) or CONTAIN (fit entire image)

# Wallpaper sets - each generates one combined image
image_sets:
  - name: Wallpaper 1.jpg    # Output filename, must be unique and include the extension (can be png, jpg, tiff, etc.)
    ignore_icc: false         # Apply ICC baking to this set if --bake-icc is enabled
    images:
      - /path/to/image1.png  # Image for first monitor (in order of screens list)
      - /path/to/image2.png  # Image for second monitor
  - name: Wallpaper 2.jpg
    ignore_icc: true         # Skip ICC baking for this set (e.g., icc is already in monitor colors)
    images:
      - /path/to/image3.jpg
```

### Step 3: Generate Wallpapers

Generate the combined wallpapers:

```bash
./start.sh generate
```

Generated images are saved to the `generated/` directory by default.

---

## Command-Line Options

### Global Options

| Option                | Description                    | Default         |
|-----------------------|--------------------------------|-----------------|
| `-c, --configuration` | Path to the configuration file | `./config.yaml` |
| `-d, --debug`         | Enable debug logging           | `False`         |

### Init Command

| Option        | Description                                        | Default  |
|---------------|----------------------------------------------------|----------|
| `--backend`   | Backend for monitor detection (`xrandr` or `none`) | `xrandr` |
| `-f, --force` | Overwrite existing configuration file              | `False`  |

### Generate Command

| Option              | Description                                           | Default           |
|---------------------|-------------------------------------------------------|-------------------|
| `-o, --output-dir`  | Output directory for generated wallpapers             | `./generated`     |
| `-r, --replace`     | Overwrite existing files in output directory          | `False`           |
| `--bake-icc`        | Bake ICC profiles into images (recommended for GNOME) | `False`           |
| `-w, --max-workers` | Maximum number of worker threads                      | CPU count (min 4) |

---

## ICC Profile Baking (Important for GNOME Users)

When using GNOME, the desktop environment does not perform color management on wallpapers. If your source images have
embedded ICC profiles (especially wide-gamut profiles), they may appear washed out or incorrect.

The `--bake-icc` option converts embedded ICC profiles to the target monitor's profile during generation, ensuring
colors display correctly.

**Note:** Images with baked ICC profiles may appear incorrect in some image viewers that do handle ICC conversion
properly. This is expected - the images will display correctly as desktop wallpaper on GNOME.

---

## Project Structure

```
.
├── main.py                      # CLI entry point
├── commands/                   # CLI command implementations
│   ├── init_cmd.py              # Monitor detection & config init
│   └── generate_cmd.py          # Wallpaper generation
├── config/                      # Configuration handling
│   └── mm_config.py              # Pydantic models & YAML load/save
├── screens/                     # Screen detection backends
│   └── xrandr.py                # xrandr backend
├── config.yaml                  # Configuration file
├── start.sh                     # Startup script (auto-venv)
└── requirements.txt             # Python dependencies
```

---

## Compatibility Disclaimer

This tool was built for Linux with X11/`xrandr`. It may work on other platforms with adjustments - contributions are
welcome!
